This project consists of a NodeJS server that serves two variants of a web page behind a feature flag, using Split's NodeJS SDK. The web page also uses the Browser RUM Agent and is built with Webpack. One of the variants (treatment 'on') loads the RUM agent asynchronously, while the other loads it synchronously.

An automation script is used to navigate the page multiple times, generating events and impressions for both treatments. The events and impressions are stored in a JSON file, and the server also exposes an endpoint with the results of a statistical analysis of the events per treatment.

# Contents

- `/client`: source code of the Web application and its two variants
  - `/client/index-async.js`: entry point for the async variant, served for treatment `ON`
  - `/client/index-sync.js`: entry point for the sync variant, served for treatment `OFF`
- `/webpack.config.js`: webpack configuration to build the two variants of the application
- `/dist`: built static assets of the application, generated by webpack
- `/server`: source code of the NodeJS server
  - `/server/index.js`: entry point of the NodeJS server
  - `/server/app.js`: endpoints that serve the two variants of the application behind a feature flag (`GET /?id=<user-id>` )
  - `/server/data.js`: endpoints for tracking events and impressions (`POST /track/*`) and for retrieving processed statistics (`GET /results`)
  - `/server/data.json`: file where events and impressions are stored
- `/automation.js`: automation script to run Puppeteer, navigate to the application and generate events and impressions

# Script

- `npm run dev`: starts Webpack with watch flag and NodeJS server with Nodemon, so that the application is rebuilt and the server restarted on file changes in the `/client` and `/server` folders respectively, for development purposes.
- `npm run build`: builds the two variants of the application
- `npm run serve`: builds the two variants of the application and starts the NodeJS server
- `npm run automation`: runs the automation script

# How to run

1. Take a copy of `.env.example` and re-name to `.env`.
2. Add your Split SDK keys and feature flag name to `.env`.
3. Run `npm install` to install dependencies.
4. Run `npm run serve` to build the app and start the server.
5. Run `npm run automation` to run the automation script. It will take a few minutes to complete, as it will generate events and impressions by navigating to the application multiple times with Puppeteer.
6. Open the browser and navigate to `http://localhost:3000/results` to see the captured events per treatments and some statistics.

Results example:

<div>
<table><tbody><tr><th>Event Type Id</th><th>Sample size ON</th><th>Sample size OFF</th><th>Mean ON</th><th>Mean OFF</th><th>P-value of one-tailed t-test</th><th>Mean ON &lt; Mean OFF (P-value &lt; 0.05)</th></tr><tr><td>webvitals.fcp</td><td>263</td><td>237</td><td>137.34524714788103</td><td>137.34524714788103</td><td>0.00005915389952916791</td><td>true (true)</td></tr><tr><td>time.to.dom.interactive</td><td>263</td><td>237</td><td>4460.518631179297</td><td>4460.518631179297</td><td>0.7924702156520088</td><td>false (false)</td></tr><tr><td>page.load.time</td><td>263</td><td>237</td><td>6157.198479087634</td><td>6157.198479087634</td><td>0.7846327340015051</td><td>false (false)</td></tr><tr><td>webvitals.ttfb</td><td>263</td><td>237</td><td>2.3068441060786014</td><td>2.3068441060786014</td><td>0.1120704959547211</td><td>true (false)</td></tr><tr><td>webvitals.lcp</td><td>263</td><td>237</td><td>3089.3608365021505</td><td>3089.3608365021505</td><td>0.5936756525875875</td><td>false (false)</td></tr><tr><td>webvitals.fid</td><td>263</td><td>236</td><td>0.5570342208722698</td><td>0.5570342208722698</td><td>0.7111375481123144</td><td>false (false)</td></tr><tr><td>webvitals.inp</td><td>222</td><td>194</td><td>8.288288288288289</td><td>8.288288288288289</td><td>0.19079362690100485</td><td>true (false)</td></tr><tr><td>webvitals.cls</td><td>222</td><td>195</td><td>0.16145071289062446</td><td>0.16145071289062446</td><td>1</td><td>false (false)</td></tr></tbody></table>
</div>
